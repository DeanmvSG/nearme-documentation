{% assign i18n_title = 'dashboard.transactables.manage' | translate %}
{% title i18n_title %}

{% capture is_client %}{% if current_user.buyer_profile == blank %}true{% else %}false{% endif %}{% endcapture %}
{% if is_client == 'true' %}
  {% assign role = 'lister' %}
{% else %}
  {% assign role = 'enquirer' %}
{% endif %}

{% if params.status != blank %}
  {% assign current_status = params.status  %}
{% else %}
  {% assign current_status = 'pending'  %}
{% endif %}

{% content_for 'page_header' %}
  <h1>
    My Orders
    <span class='hidden-xs'>&gt; {{ current_status | humanize }}</span>
  </h1>

  <div class='options'>
    {% if is_client == "true" %}
      <a href='{{ transactable_type.new_transactable_path }}' class='btn btn-primary'>
        <span class='fa fa-plus'></span>
        Create a new order
      </a>
    {% endif %}
    {% if current_user.has_seller_profile? %}
      <a href="/search" class="btn btn-primary">Find a Vendor</a>
    {% endif %}
  </div>

{% endcontent_for %}

<div class="sort-filter-search-wrapper">
    <div class="sort-filter-a">
      <form novalidate="novalidate" class="simple_form transactable" action="{{ form_url }}" accept-charset="UTF-8" method="get">
        <input type="hidden" name="status" value="{{ current_status }}">
        <div class="form-group">
          <label for="filter-order-by" class="control-label">Order</label>
          <select id="filter-order-by" name="order_by">
            <option value="created_at desc">Newest</option>
            <option value="created_at asc" {% if params.order_by == 'created_at asc' %}selected{% endif%}>Oldest</option>
          </select>
        </div>
        <div class="form-action">
          <button type="submit" class="btn btn-primary">Apply filter</button>
        </div>
      </form>
    </div>
</div>

{% content_for 'panel_navigation_links' %}
    <li class='{{ 'pending' | active_class:current_status }}'>
      <a href='{{ tt.transactable_types_path | append: "?status=pending" | append: filter_params }}'>Pending Orders ({{ pending_transactables | total_entries }})</a>
    </li>
    <li class='{{ 'in progress' | active_class:current_status }}'>
      <a href='{{ tt.transactable_types_path | append: "?status=in+progress" | append: filter_params }}'>Accepted Orders ({{ in_progress_transactables | total_entries }})</a>
    </li>
    <li class='{{ 'archived' | active_class:current_status }}'>
      <a href='{{ tt.transactable_types_path | append: "?status=archived" | append: filter_params }}'>Archived Orders ({{ archived_transactables | total_entries }})</a>
    </li>
{% endcontent_for %}


<nav class='panel-nav-mobile' role='navigation'>
  {% if current_status == 'pending' %}
    {% capture nav_label %}Pending Orders ({{ pending_transactables | total_entries }}){% endcapture %}
  {% elsif current_status == 'in progress' %}
    {% capture nav_label %}Orders in Progress ({{ in_progress_transactables | total_entries }}){% endcapture %}
  {% elsif current_status == 'archived' %}
    {% capture nav_label %}Archived Orders ({{ archived_transactables | total_entries }}){% endcapture %}
  {% endif %}
  {% dropdown_menu { label: nav_label, wrapper_class: 'links' } %}
    {% yield 'panel_navigation_links' %}
  {% enddropdown_menu %}
</nav>

<nav class='panel-nav'>
  <ul class='tabs pull-left'>
    {% yield 'panel_navigation_links' %}
  </ul>
  {% yield 'panel_options' %}
</nav>

{% if current_status == 'pending' %}
  {% include 'dashboard/company/transactables/listing.html' transactables: pending_transactables, param_name: 'pending_page' %}
{% elsif current_status == 'in progress' %}
  {% include 'dashboard/company/transactables/listing.html' transactables: in_progress_transactables, param_name: 'in_progress_page' %}
{% elsif current_status == 'archived' %}
  {% include 'dashboard/company/transactables/listing.html' transactables: archived_transactables, param_name: 'archived_page' %}
{% endif %}
