<div class="collaborations-content">
  <header>
    <h2>Request Proposal</h2>
    <button type="button" data-close>Close</button>
  </header>

  {% assign collaborators = current_user | find_collaborators_for_user_transactables: user %}

  {% if collaborators.size > 0 %}
    <div class="existing-collaborations" data-delete-url="{{ 'dashboard_company_transactable_collaborators_path' | generate_url }}">
      <h3>You have requested proposal for your order from {{ user.name }}.</h3>
      <ul>
        {% for collaborator in collaborators %}
        <li>
          {{ collaborator.transactable.name }}
          {% if collaborator.transactable.pending? %}
            <button type="button" class="button-b action-remove" data-transactable-collaborator-id="{{ collaborator.id }}" data-transactable-id="{{ collaborator.transactable.id }}" data-remove-collaborator>Remove</button>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {% if current_user.transactables_without_collaborators.size > 0 %}

    {% if user.pending_collaborated_transactables.size == 0 %}
      <p><strong>{{ user.name }}</strong> will receive your proposal request.</p>
      <p>Please select your order:</p>
    {% else %}
      <p>You have other order, would you like to request a proposal from <strong>{{ user.name }}</strong> for another one? If so, please select from the list below.</p>
    {% endif %}

    <form method="post" action="{{ 'dashboard_company_transactable_collaborators_path' | generate_url }}">
      <input type="hidden" name="transactable_collaborator[user_id]" value="{{ user.id }}">
      <input type="hidden" name="authenticity_token" value="{{ form_authenticity_token }}" />

      <div class="control-group">
        <label for="projects-list" class="control-label">My orders</label>
        <span class="select-a">
          <select id="projects-list" name="transactable_collaborator[transactable_id]" class="unstyled-select" data-projects-list>
            {% for transactable in current_user.transactables_without_collaborators %}
            <option value="{{ transactable.id }}">{{ transactable.name }}</option>
            {% endfor %}
          </select>
        </span>
      </div>

      <div class="actions">
        <button type="submit" class="button-a">Invite</button>
        {% if user.pending_collaborated_transactables.size == 0 %}
          <button type="button" class="button-b" data-close>Cancel</button>
        {% else %}
          <button type="button" class="button-b" data-close>I'm done</button>
        {% endif %}
      </div>
    </form>


  {% elsif current_user.transactables.size == 0 %}

    <p>In order to request a proposal, you must first create a new order.</p>

    <p>Would you like to create an order now?</p>

    <div class="actions">
      <a href="{{ platform_context.transactable_types[0].new_transactable_path }}" class="button-a">Create an order</a>
      <button type="button" class="button-b" data-close>Cancel</button>
    </div>

  {% else %}

    <p>There are no other orders to request a proposal for from {{ user.name }}. Would you like to create another order right now?</p>

    <div class="actions">
      <a href="{{ platform_context.transactable_types[0].new_transactable_path }}" class="button-a">Create an order</a>
      <button type="button" class="button-b" data-close>I'm done</button>
    </div>
  {% endif %}
</div>
