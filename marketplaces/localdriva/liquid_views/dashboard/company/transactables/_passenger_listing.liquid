{% for transactable in transactables %}
  {% assign collaborator = transactable.transactable_collaborators[0] %}
  {% assign offer = transactable.orders | select: user_id: collaborator.user.id | first %}
  <article class="listing-b" id="transactable_{{transactable.id}}">

    {% if transactable.state == 'pending' and collaborator != blank %}
      {% if offer != blank and offer.unconfirmed? %}
        <span class="label label-success">Approved by Driver, waiting for your payment</span>
      {% elsif offer != blank and offer.rejected? %}
        <span class="label label-failure">Approved by Driver, waiting for your payment</span>
      {% else %}
        <span class="label label-success">Waiting for Driver to approve</span>
      {% endif %}
    {% elsif transactable.state == 'completed' %}
      <span class="label label-success">Completed</span>
    {% elsif transactable.state == 'cancelled' %}
      <span class="label label-warning">Cancelled</span>
    {% endif %}

    <h2>{{ transactable.name }}</h2>

    <div class="row">
      <div class="col-md-8">
        <dl class="properties">
          <dt>Date</dt>
          <dd>{{ transactable.properties.trip_start_date | to_date | l: 'short' }}</dd>

          <dt>Start Time</dt>
          <dd>{{ transactable.properties.trip_start_time }}</dd>

          <dt>Length</dt>
          {% assign duration = transactable.properties.duration | plus: 0 %}
          <dd>{{ duration }} {% if duration == 1 %}hour{% else %}hours{% endif %}</dd>

          <dt>Pickup Location</dt>
          <dd>{{ transactable.properties.pickup_location }}</dd>
        </dl>
      </div>
      <div class="col-md-4">
        {% include 'dashboard/company/transactables/passenger_actions.html' %}
      </div>
    </div>

    {% if collaborator != blank %}
      {% assign  driver = collaborator.user %}
      <div class="row">

        <dl class="properties">
          <dt>Driver Name</dt>
          <dd>{{ driver.name }}</dd>

          <dt>Invite Sent</dt>
          <dd>{{ collaborator.created_at | to_date | l: 'short' }}</dd>

          {% for language in driver.buyer_profile.customizations_by_type['Languages'] %}
            {% capture langs %}{{ langs }}{% unless langs == blank %}, {% endunless %}{{ language.language }} ({{ language.fluency }}){% endcapture %}
          {% endfor %}

          {% if langs != blank %}
            <dt>Languages Spoken:</dt>
            <dd>{{ langs }}</dd>
          {% endif %}

          <dt>Number of Passengers</dt>
          <dd>{{ driver.buyer_properties.vehicle_capacity }}</dd>

          <dt>Extras</dt>
          <dd>{{ driver.formatted_buyer_categories['Extras']['children'] | join: ', ' }}</dd>

          <dt>Price</dt>
          <dd>{{ driver.buyer_properties.hourly_price }}</dd>
        </dl>
      </div>
    {% endif %}

  </article>
{% endfor %}
