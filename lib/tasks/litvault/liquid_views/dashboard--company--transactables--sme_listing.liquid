{% for transactable in transactables %}
  {% assign transactable_collaborator = current_user  | find_collaborator: transactable %}
  <article class="listing-b" id="transactable_{{transactable.id}}">
    <h2>{{ transactable.name }}</h2>

    <div class="col-md-8">
      {{ transactable.properties.types_of_injuries_included }}
      Days of Hospitalization: {{ transactable.properties.days_of_hospitalization }}
      Death Case: {{ transactable.properties.involve_wrongful_death }}
      {{ transactable.properties.case_short_description }}
    </div>
    <div class="col-md-4">
      {% if transactable_collaborator.approved_by_owner? %}
        Access Approved
      {% elsif transactable_collaborator.rejected_by_owner? %}
        Access Rejected
      {% else %}
        Access Requested
      {% endif %}
    </div>

    {% if transactable.description != blank %}
        <hr>
        <h4>Description:</h4>
        {% if transactable.description.size > 350 %}
           <div data-shorten-description>
            <p data-description>{{ transactable.description | slice: 0, 350 | nl2br }}<span class="show_more_container">...<a class="show_more_link"> show more</a></span></p>
            <div style='display: none;'  class="rest_of_text">{{ transactable.description | slice: 350, transactable.description.size | nl2br }}</div>
          </div>
        {% else %}
          <p>{{ transactable.description | nl2br }}</p>
        {% endif %}
    {% endif %}

    <h3>Request To View Case Details:</h3>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Handling Lawyer:</th>
            <th>Date:</th>
            <th>Status:</th>
          </tr>
        </thead>
        <tbody>
            <tr>
              <td>{{ transactable_collaborator.user.name }}</td>
              <td>{{ transactable_collaborator.created_at | to_date | l: 'short' }}</td>
              <td>{{ transactable_collaborator.status }}</td>
              <td><a class="btn btn-info" data-modal="true" href="{{ 'new_listing_user_message_path' | generate_url: transactable.id, skip: true }}">Send message</a></td>
            </tr>
        </tbody>
      </table>
    </div>

    {% if transactable_collaborator.approved_by_owner? %}
      <a href="{{ transactable.show_path }}" class="btn btn-default">Project Details</a>
    {% else %}
      <a href="{{ transactable_collaborator.enquirerer_destroy_path }}" data-method="delete" data-confirm="Are you sure?" class="btn btn-default">Cancel Request</a>
    {% endif %}

    <hr>
  </article>
{% endfor %}
