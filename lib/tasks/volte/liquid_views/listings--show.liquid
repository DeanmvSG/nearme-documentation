{% assign photos = listing.photos %}
{% assign photos_count = photos | size %}

<div class="wrapper-a">

  <div class="item-top-bar">
    <div class="user-bar">
      <div class="user-bar__photo" style="background-image: url('{{ listing.creator.avatar_url_thumb }}')">
      </div>

      <div class="flex-container">
        <div class="user-bar__name">
          <a href="{{ listing.creator.user_profile_url }}">{% if listing.creator.properties.use_alias_as_name == '1' %}{{ listing.creator.properties.user_alias }}{% else %}{{ listing.creator.name }}{% endif %}</a>
        </div>
        <div class="user-bar__action-bar">
          <ul>
            <li>
              {% if listing.transactable_user_messages.size > 0 %}
                <a class="button button-inverse button-small" data-modal="true" data-href="{{ 'dashboard_user_message_path' | generate_url: listing.transactable_user_messages.first.id, skip: true }}">Message</a>
              {% else %}
                <a class="button button-inverse button-small" data-modal="true" data-href="{{ 'new_listing_user_message_path' | generate_url: listing.id ,user_id: listing.creator.id, skip: true }}">Message</a>
              {% endif %}
            </li>
            <li><a href="{{ listing.creator.user_profile_url }}" class="button button-inverse button-small">Lender's Closet</a></li>
            {% if listing.creator.has_active_blog? %}
              <li><a href="{{ listing.creator.user_blog_posts_list_path }}" class="button button-inverse button-small">Lender's Blog</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>

    <div class="item-pricing">
      <dl>
        {% for price in listing.action_type.sorted_pricings %}
          <dt>{{ price.number_of_units }} days: </dt>
          <dd>${{ price.price.amount }} AUD</dd>
        {% endfor %}
        <dt>Bond value: </dt>
        <dd>${{ listing.properties.bond_value }} AUD</dd>
      </dl>
    </div>
  </div>


  <div class="item-content">
    <div class="item-name">
      <h1>{{ listing.name | filter_text }}</h1>
    </div>

    <div class="image-gallery" data-image-gallery>
      <div class="image-gallery__container">
      {% if photos_count > 0 %}
        <div class="image-gallery__container-image" style="background-image: url('{{ photos[0].original  }}'); background-size: 100%;" data-image-gallery-full-image></div>
      {% endif %}
      </div>

      <div class="image-gallery__controls-container">
        <ul class="image-gallery__zoom-controls">
          <li><a href="#" data-image-gallery-zoom="1"><i class="fa fa-arrows-alt" aria-hidden="true"></i></a></li>
          <li><a href="#" data-image-gallery-zoom="+1"><i class="fa fa-plus" aria-hidden="true"></i></a></li>
          <li><a href="#" data-image-gallery-zoom="-1"><i class="fa fa-minus" aria-hidden="true"></i></a></li>
        </ul>

          {% if photos_count > 1 %}
            <ul class="image-gallery__list">
              {% assign index = 0 %}
              {% for photo in photos %}
                <li data-image-gallery-image><a href="#"><img src="{{ photo.space_listing }}" data-image-gallery-full-image-url="{{ photo.original }}" /></a></li>
              {% endfor %}
            </ul>
          {% endif %}
      </div>
    </div> <!-- Image gallery -->
  </div> <!-- Item content -->

  <div class="item-sidebar">
    <div class="item-actions">
      <ul>
        <li class="separated">
          <form id="order_form_{{ listing.id }}" novalidate="novalidate" class="order" action="{{ 'listing_orders_path' | generate_url: listing }}" accept-charset="UTF-8" method="post">
            <input name="utf8" type="hidden" value="">
            <input name="authenticity_token" value="{{ form_authenticity_token }}" data-authenticity-token type="hidden">
            <input value="{{ listing.id }}" type="hidden" name="order[transactable_id]" id="order_transactable_id">
            <input value="{{ listing.action_type.pricings.first.id }}" type="hidden" name="order[transactable_pricing_id]" id="order_transactable_pricing_id">
            <input type="submit" class="button button-default" value="REQUEST ITEM">
          </form>
        <li><a data-listing-availability-toggle data-listing-availability-periods={{ listing.unavailable_periods }} class="button button-default datetimepicker"><input type="hidden" />CHECK AVAILABILITY</a></li>
        <li>
          <div data-add-favorite-button="true" data-path="{{ listing.wish_list_path }}" data-wishlistable-type="{{ listing.class_name }}" data-link-to-classes="button button-default" data-path-bulk="{{ listing.wish_list_bulk_path }}" data-object-id="{{ listing.id }}" id="favorite-button-{{ listing.class_name }}-{{ listing.id }}">
            <div class="text-center"><img src="{{ 'components/modal/loader.gif' | image_url }}" /></div>
          </div>
        </li>
      </ul>
    </div> <!-- Item actions -->

    <div class="item-details">
     <ul>
        <li class="active">
          <a data-toggle='tab' href='#tab-details'>Details</a>
        </li>
        <li>
          <a data-toggle='tab' href='#tab-description'>Description</a>
        </li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane active" id="tab-details">
          <dl>
            <dt>Item:</dt> <dd>{{ listing.properties.item_type }}</dd>
            {% if listing.properties.item_type == 'Dress' %}
              <dt>Style:</dt> <dd>{{ listing.properties.item_style_dress }}</dd>
              <dt>Size:</dt> <dd>{{ listing.properties.dress_size }}</dd>
              <dt>Length:</dt> <dd>{{ listing.properties.dress_length }}</dd>
            {% elsif listing.properties.item_type == 'Bag' %}
              <dt>Style:</dt> <dd>{{ listing.properties.item_style_bag }}</dd>
              <dt>Length:</dt> <dd>{{ listing.properties.dress_length }}</dd>
            {% elsif listing.properties.item_type == 'Millinery' %}
              <dt>Style:</dt> <dd>{{ listing.properties.item_style_milinery }}</dd>
              <dt>Size:</dt> <dd>{{ listing.properties.milinery_size }}</dd>
            {% elsif listing.properties.item_type == 'Outerwear' %}
              <dt>Style:</dt> <dd>{{ listing.properties.item_style_outerwear}}</dd>
              <dt>Size:</dt> <dd>{{ listing.properties.outerwear_size }}</dd>
            {% elsif listing.properties.item_type == 'Accessories' %}
              <dt>Style:</dt> <dd>{{ listing.properties.item_style_accessories }}</dd>
            {% endif %}
            <dt>Color:</dt> <dd>{{ listing.properties.color }}</dd>
            <dt>Designer:</dt> <dd>{{ listing.properties.designer_name }}</dd>
            <dt>Location:</dt> <dd>{{ listing.location.city }}, {{ listing.location.state }}</dd>
            <dt>Retail Value:</dt>  <dd>{{ listing.properties.retail_value }}</dd>
            <dt>Dry Cleaning:</dt>  <dd>{{ listing.properties.dry_cleaning }}</dd>
          </dl>
        </div>
        <div class="tab-pane" id="tab-description">
          <p>
            {{ listing.description }}
          </p>
        </div>
      </div>
    </div> <!-- Item details -->
  </div> <!-- Item sidebar -->


  {% if listing.tags.size > 0 %}
    <div class="item-tags" data-item-tags>
      <h4>Tags:</h4>
      <ul>
        {% for tag in listing.tags %}
          {% if forloop.index <= 5 %}
            <li><a href="#" class="button button-inverse">{{ tag.name }}</a></li>
          {% else %}
            <li class="item-tags__hide" data-item-tags-hidden><a href="#" class="button button-inverse">{{ tag.name }}</a></li>
          {% endif %}

          {% if listing.tags.size > 5 %}
            {% if forloop.index == listing.tags.size %}
              <li class="item-tags__view-more" data-item-tags-toggle><a href="#" class="button button-inverse">view more</a></li>
            {% endif %}
          {% endif %}
        {% endfor %}
      </ul>
    </div> <!-- Item tags -->
  {% endif %}

  <div class="item-disclaimers">
    <h2>Cancellation policy</h2>

    <p>What do you need to know... lorem ipsum</p>
  </div>
</div> <!-- Wrapper -->
