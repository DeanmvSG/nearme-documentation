- no_footer!

= render 'search/meta_tags'

- content_for :mixed_locations do
  - if @searcher.results.any?
    .locations
      .hidden-locations
        = render partial: 'search/map/location_marker', collection: @searcher.results, as: :location
        %input{type: 'hidden', id: 'result_count', value: @searcher.result_count}
        %input{type: 'hidden', name: 'meta_title', value: meta_title_for_search(platform_context, @searcher.search, @searcher.transactable_type.name)}
      = render 'search/mixed/pagination', locations: @searcher.results, result_count: @searcher.result_count
      = render partial: 'search/mixed/individual_listing', collection: @searcher.results, locals: {search: @searcher.search}, as: :listing
      = render 'search/mixed/pagination', locations: @searcher.results, result_count: @searcher.result_count
  - elsif !@searcher.located
    .locations
      .hidden-locations
        %input{type: 'hidden', id: 'result_count', value: @searcher.result_count}
        %input{type: 'hidden', name: 'meta_title', value: meta_title_for_search(platform_context, @searcher.search, @searcher.transactable_type.name)}
      %div.no_results
        = render 'shared/loading_spinner'
        .text-center
          %br/
          %br/
          %h1.tk-adelle.fat No results found
          %p
            = searchable_item_could_not_be_found_text
  - else
    .locations
      .hidden-locations
        %input{type: 'hidden', id: 'result_count', value: @searcher.result_count}
        %input{type: 'hidden', name: 'meta_title', value: meta_title_for_search(platform_context, @searcher.search, @searcher.transactable_type.name)}
      %div.no_results
        = render 'shared/loading_spinner'
        .text-center
          %br/
          %br/
          %h1.tk-adelle.fat No results found, but!
          #search-notification
            = render 'search_notifications/form', search_notification: @searcher.search_notification

- content_for :hero do
  = render 'search/mixed/header'

  %section#results.mixed
    = render 'shared/loading_spinner'
    .map
      %section#map.google-map-wrapper
        .google-map
          #listings_map.inner
    .list{:'data-list' => true}
      .filters{:'data-search-filters-container' => true}

        = render partial: 'search/mixed/filter', locals: { header_name: 'Category', selected_values: @searcher.category_ids || [], input_name: 'category_ids[]', options: @searcher.category_options}
        #categories-children

        = render partial: 'search/shared/date_range'
        - @searcher.filterable_custom_attributes.each do |ca|
          = render partial: 'search/mixed/filter', locals: { header_name: t(ca.label_key), selected_values: @searcher.search.lg_custom_attributes[ca.name.to_sym] || [], input_name: "lg_custom_attributes[#{ca.name}][]", options: ca.valid_values_translated, name: ca.name }
        = render partial: 'search/mixed/filter', locals: { header_name: 'Pricing', selected_values: @searcher.search.lgpricing_filters || [], input_name: 'listing_pricing[]', options: @searcher.filterable_pricing }
        - if platform_context.instance.location_types.count > 1
          = render :partial => 'search/mixed/filter', :locals => { :header_name => 'Location Type', :selected_values => @searcher.search.lntypes_filters || [], :input_name => 'location_types_ids[]', :options => @searcher.filterable_location_types.map { |lt| [lt.name.downcase, lt.name ] } }

      .sort
        .results-count
          %h3#search_results_count
            = @searcher.result_count
            results
        = render 'search/save'
        .per-page
          %span per page
          = select_tag :per_page, options_for_select(['20', '50', '100'].map{|v| [v, v]})

      - if not request.xhr?
        = yield :mixed_locations

- if request.xhr?
  = yield :mixed_locations

- content_for :domready do
  new Search.SearchMixedController($('#listing_search form'), $('section#results'));
