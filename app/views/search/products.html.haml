- title @searcher.query
- meta_description @searcher.query

- content_for :product_results do
  %section#results.search-results{class: platform_context.display_taxonomy_tree? ? "span9" : "span12"}
    .row
      %p.search-breadcrumbs
        #{@searcher.result_count} results for "#{@searcher.query}"
      .sort-wrapper
        .search-bar
          %form{action: search_path(v: 'products'), method: 'get', id: 'search_form'}
            = text_field_tag :query, @searcher.query, placeholder: 'What are you looking for?'
            = hidden_field_tag :transactable_type_id, @transactable_type.id
            = hidden_field_tag :buyable, true
            = hidden_field_tag :category_ids, @searcher.category_ids
            = hidden_field_tag :page, params[:page]
            %button.btn.blue.search
              = image_tag 'themes/buy_sell/search-icon.png'
            - @searcher.filterable_custom_attributes.each do |ca|
              %span
                = label_tag t(ca.label_key)
                = select_tag "lg_custom_attributes[#{ca.name}][]", options_for_select(ca.valid_values_translated, @searcher.search.lg_custom_attributes[ca.name.to_sym] || []), include_blank: true
            %span.sort-pages.sort
              = label_tag :per_page, 'Per page:'
              = select_tag :per_page, options_for_select(%w(20 50 100).map{|v| [v, v]}, params[:per_page]), onchange: '$("#search_form").submit();'
    - @searcher.results.decorate.in_groups_of(3) do |line|
      .row
        - line.compact.each do |product|
          = render 'search/products/product', { product: product }

    - if @searcher.results.total_pages > 1
      = will_paginate_styled(@searcher.results)

    = render 'shared/loading_spinner'
    - unless @searcher.results.any?
      .text-center
        %h1 No results found!

- if request.xhr?
  = yield :product_results
- else
  - content_for :category_tree do
    - if platform_context.display_taxonomy_tree?
      .span3{"data-search-filters-container" => true}
        %section#category-tree
          - Category.roots.products.searchable.each do |category|
            .nav-categories.collapse.in
              %ul
                %li.nav-heading
                  = label_tag "category_#{category.id}" do
                    = check_box_tag("category_ids[]", category.id, @searcher.category_ids.include?(category.id.to_s), id: "category_#{category.id}")
                    = category.name
                = category_tree(category, @category, 2, @searcher.category_ids)
  .search-view
    .crumbs= render_crumbs
    .page-wrapper.row-fluid
      = yield :category_tree
      = yield :product_results


  - content_for :domready do
    new Search.ProductsSearchController($('#search_form'), $('.search-view'))