- title @searcher.query
- meta_description @searcher.query
.search-view
  .crumbs= render_crumbs
  .page-wrapper.row-fluid
    - if platform_context.display_taxonomy_tree?
      %nav.span2
        - @taxons.each do |taxon|
          .nav-categories.collapse.in
            %ul
              %li.nav-heading= taxon.name
              = taxons_tree(taxon, @taxon, 1)

    %section.search-results{class: platform_context.display_taxonomy_tree? ? "span10" : "span12"}
      .row
        %p.search-breadcrumbs
          #{@searcher.result_count} results for "#{@searcher.query}"
        .sort-wrapper
          .search-bar
            %form{action: search_path(v: 'products'), method: 'get', id: 'search_form'}
              = text_field_tag :query, @searcher.query, placeholder: 'What are you looking for?'
              = hidden_field_tag :transactable_type_id, @transactable_type.id
              = hidden_field_tag :buyable, true
              %button.btn.blue.search
                = image_tag 'themes/buy_sell/search-icon.png'
              - @searcher.filterable_custom_attributes.each do |ca|
                %span
                  = label_tag t(ca.label_key)
                  = select_tag "lg_custom_attributes[#{ca.name}][]", options_for_select(ca.valid_values_translated, @searcher.search.lg_custom_attributes[ca.name.to_sym] || []), include_blank: true
              %span.sort-pages.sort
                = label_tag :per_page, 'Per page:'
                = select_tag :per_page, options_for_select(%w(20 50 100).map{|v| [v, v]}, params[:per_page]), onchange: '$("#search_form").submit();'

      - @searcher.results.decorate.in_groups_of(3) do |line|
        .row
          - line.each do |product|
            .span4.result-item{'data-product-id' => product.try(:id)}
              - if product
                = link_to product_url(product), class: 'item' do
                  .item-img
                    = image_tag product.first_image_url
                  .details.clearfix
                    %p= product.name
                    %p.name= product.company.name
                    %p.price= product.display_price

      - if @searcher.results.total_pages > 1
        = will_paginate_styled(@searcher.results)

      = render 'shared/loading_spinner'
      - unless @searcher.results.any?
        .text-center
          %h1 No results found!
