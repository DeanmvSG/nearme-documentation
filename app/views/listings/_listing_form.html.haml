- only_inputs = [] if only_inputs.nil?
- photo_input_name_prefix = "listing" if local_assigns[:photo_input_name_prefix].nil?

- if f.object.free?
  - enable_inputs_daily, enable_inputs_hourly, enable_inputs_free = false, false, true
- elsif f.object.hourly_reservations
  - enable_inputs_daily, enable_inputs_hourly, enable_inputs_free = false, true, false
- else
  - enable_inputs_daily, enable_inputs_hourly, enable_inputs_free = true, false, false


- if only_inputs.empty? || only_inputs.include?(:enabled)
  .listing-enabled-container 
    .control-group
      = f.label :enabled, 'Enabled?'
      .switch-wrapper
        .switch{'data-on-label' => "", 'data-off-label' => "", 'data-ajax-updateable' => f.object.persisted?}
          = f.check_box :enabled

= f.input :id, :as => :hidden if only_inputs.empty? || only_inputs.include?(:id)
= f.input :name, :label => "#{platform_context.bookable_noun} name" if only_inputs.empty? || only_inputs.include?(:name)
= f.input :description, :label => "#{platform_context.bookable_noun} description", :input_html => { :maxlength => 250} if only_inputs.empty? || only_inputs.include?(:description)
= f.association :listing_type, :label => "#{platform_context.bookable_noun} type", :collection => platform_context.instance.listing_types, :input_html => { :class => 'selectpicker' } if only_inputs.empty? || only_inputs.include?(:listing_type)
= f.input :quantity, :label => 'Quantity available', :placeholder => 2, :input_html => { :class => "mini" } if only_inputs.empty? || only_inputs.include?(:quantity)
= f.association :amenities, :collection => platform_context.instance.amenity_types.order(:name), :as => :grouped_select, :group_method => :amenities, :group_label_method => :name, :label => "Amenities", :blank => false, :input_html => { 'data-placeholder' => "Select one or more", :class => 'custom-select', :multiple => true } if only_inputs.empty? || only_inputs.include?(:amenities)

- if content_for? :currency
  = yield(:currency)
- else
  = hidden_field_tag '', listing.location.currency, :id => 'currency-select'

- if only_inputs.empty? || only_inputs.include?(:price)
  %div{:class => "control-group #{"error" if f.object.errors.include?(:free).present?}"}
    = f.label :daily_price, 'Price', :class => 'control-label flush-top' do
      %abbr{:title => "required"} *
      Price

    .controls
      %div.price-inputs-daily
        %label.radio
          = f.radio_button :price_type, "daily", :checked => enable_inputs_daily
          Daily, weekly, or monthly

        .price-input-options
          .price-inputs-wrapper.left
            = render 'manage/listings/price_field', :f => f, :price => "daily", :label => "day", :include_checkbox => true
            = render 'manage/listings/price_field', :f => f, :price => "weekly", :label => "week", :include_checkbox => true
            = render 'manage/listings/price_field', :f => f, :price => "monthly", :label => "month", :include_checkbox => true

      %div.price-inputs-hourly
        %label.radio
          = f.radio_button :price_type, "hourly", :checked => enable_inputs_hourly
          Hourly

        .price-input-options
          .price-inputs-wrapper.left
            = render 'manage/listings/price_field', :f => f, :price => "hourly", :label => "hour"

      - if f.object.errors.include?(:hourly_reservations).present?
        %p.error-block= f.object.errors[:hourly_reservations].first

      %div.price-inputs-free
        %label.radio
          = f.radio_button :price_type, "free", :checked => enable_inputs_free
          Free

      - if f.object.errors.include?(:price_type).present?
        %p.error-block= f.object.errors[:price_type].first

  - if f.object.errors.include?(:free).present?
    %p.error-block
      = 'must be free if all prices are zero'

- if only_inputs.empty? || only_inputs.include?(:availability_rules)
  .control-group
    = render :partial => 'availability_rules/form', :locals => { :f => f }


- if only_inputs.empty? || only_inputs.include?(:confirm_reservations)
  %div{:class => "control-group #{"error" if f.object.errors.include?(:confirm_reservations).present?}"}
    = f.label :confirm_reservations, "Confirm #{platform_context.lessee} bookings", :class => 'control-label'
    .controls
      .switch{'data-on-label' => "", 'data-off-label' => ""}
        = f.check_box :confirm_reservations

- if only_inputs.empty? || only_inputs.include?(:photos)
  .loading{:style => "display: none"}
    = image_tag "spinner.gif"
    %br/
    .span= t('manage.listings.photos.waiting_for_photo_processing')
  = file_upload_input_with_label('Photos',
                                  "#{photo_input_name_prefix}[photos_attributes][0][image]",
                                  manage_photos_path,
                                  Photo.new.image.thumbnail_dimensions[:medium],
                                  "Browse",
                                  :required => true,
                                  :error => f.object.errors.include?(:photos).present? ? "Please upload at least one photo." : nil) do
    - # caches img so it is displayed even for the first photo. Without this, loader icon is not displayed for the first photo
    .hidden.thumbnail-processing
      .loading-icon
    = hidden_field_tag "#{photo_input_name_prefix}[photos_attributes]", nil, :placeholder => 'Enter Caption...', :id => 'photo-item-input-template', :disabled => true, 'data-number' => 0
    - unless @photos.nil?
      - @photos.each_with_index do |photo|
        = get_fileupload_photo_html(photo.image_url(:medium),
                                    destroy_space_wizard_photo_path(:id => photo.id),
                                    edit_manage_photo_path(photo),
                                    :div,
                                    id: photo.id) do
          = text_field_tag "#{photo_input_name_prefix}[photos_attributes][#{photo.id}][caption]", photo.caption, :placeholder => 'Enter Caption...'
          = hidden_field_tag "#{photo_input_name_prefix}[photos_attributes][#{photo.id}][id]", photo.id
          = hidden_field_tag "#{photo_input_name_prefix}[photos_attributes][#{photo.id}][position]", photo.position, class: 'photo-position-input'

.hidden
  - Money::Currency.table.values.each do |c|
    %span{:id => "currency_#{c[:iso_code]}"} 
      = c[:symbol]
