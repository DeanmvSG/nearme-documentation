- title "Order view"

%section
  .row-fluid
    .span8.offset2
      %h1
        %span.ico-bookings.padding="Order - #{@order.number}"
      .box
        - if @order.has_step?("address")
          %h3 Billing Address:
          .summary-line
            = render :partial => 'address', :locals => { :address => @order.bill_address }
          - if @order.has_step?("delivery")
            %h3 Shipping Address:
            .summary-line
              = render :partial => 'address', :locals => { :address => @order.ship_address }
            - if @order.has_step?("delivery")
              %h3 Shippments:
              .summary-line
                - @order.shipments.each do |shipment|
                  = Spree.t(:shipment_details, :stock_location => shipment.stock_location.name, :shipping_method => shipment.selected_shipping_rate.name)

        %h3 Payment information:
        .summary-line
          - @order.payments.valid.each do |payment|
            %div
              .text-label Payment method
              .text Credit Card
            %div
              .text-label Amount
              .text= number_to_currency_symbol(payment.order.currency, payment.amount)

        %h3 Ordered items:
        .summary-line

        %table.summary
          %col{:halign => "center", :valign => "middle", :width => "15%"}/
          %col{:valign => "middle", :width => "40%"}/
          %col{:halign => "center", :valign => "middle", :width => "15%"}/
          %col{:halign => "center", :valign => "middle", :width => "15%"}/
          %col{:halign => "center", :valign => "middle", :width => "15%"}/
          %thead{"data-hook" => ""}
            %tr{"data-hook" => "order_details_line_items_headers"}
              %th{:colspan => "2"}= Spree.t(:item)
              %th.price= Spree.t(:price)
              %th.qty= Spree.t(:qty)
              %th.total
                %span= Spree.t(:total)
          %tbody{"data-hook" => ""}
            - @order.line_items.each do |item|
              %tr{"data-hook" => "order_details_line_item_row"}
                %td{"data-hook" => "order_item_image"}
                  - if item.variant.images.length == 0
                    = link_to small_image(item.variant.product), item.variant.product
                  - else
                    = link_to image_tag(item.variant.images.first.image.url(:medium)), item.variant.product
                %td{"data-hook" => "order_item_description"}
                  %h4= item.variant.product.name
                  = item.variant.product.description.truncate(30)
                  = "(" + item.variant.options_text + ")" unless item.variant.option_values.empty?
                %td.price{"data-hook" => "order_item_price"}
                  %span= item.single_money.to_html
                %td{"data-hook" => "order_item_qty"}= item.quantity
                %td.total{"data-hook" => "order_item_total"}
                  %span= item.display_amount.to_html
          %tfoot#order-total{"data-hook" => "order_details_total"}
            %tr.total
              %td{:colspan => "4"}
                %b
                  = Spree.t(:order_total)
                  \:
              %td.total
                %span#order_total= @order.display_total.to_html
          %tfoot#subtotal{"data-hook" => "order_details_subtotal"}
            %tr#subtotal-row.total
              %td{:colspan => "4"}
                %b
                  = Spree.t(:subtotal)
                  \:
              %td.total
                %span= @order.display_item_total.to_html
          / - if @order.line_item_adjustments.exists?
          /   - if @order.all_adjustments.promotion.eligible.exists?
          /     %tfoot#price-adjustments{"data-hook" => "order_details_price_adjustments"}
          /       - @order.all_adjustments.promotion.eligible.group_by(&:label).each do |label, adjustments|
          /         %tr.total
          /           %td{:colspan => "4"}
          /             = Spree.t(:promotion)
          /             \:
          /             %strong= label
          /           %td.total
          /             %span= Spree::Money.new(adjustments.sum(&:amount), currency: order.currency)
          %tfoot#shipment-total
            - @order.shipments.group_by { |s| s.selected_shipping_rate.name }.each do |name, shipments|
              %tr.total{"data-hook" => "shipment-row"}
                %td{:colspan => "4"}
                  = Spree.t(:shipping)
                  \:
                  %strong= name
                %td.total
                  %span= Spree::Money.new(shipments.sum(&:discounted_cost), currency: @order.currency).to_html
          / - if @order.all_adjustments.tax.exists?
          /   %tfoot#tax-adjustments{"data-hook" => "order_details_tax_adjustments"}
          /     - @order.all_adjustments.tax.group_by(&:label).each do |label, adjustments|
          /       %tr.total
          /         %td{:colspan => "4"}
          /           = Spree.t(:tax)
          /           \:
          /           %strong= label
          /         %td.total
          /           %span= Spree::Money.new(adjustments.sum(&:amount), currency: @order.currency)
          / %tfoot#order-charges{"data-hook" => "order_details_adjustments"}
          /   - @order.adjustments.eligible.each do |adjustment|
          /     - next if (adjustment.source_type == 'Spree::TaxRate') and (adjustment.amount == 0)
          /     %tr.total
          /       %td{:colspan => "4"}
          /         %strong= adjustment.label
          /       %td.total
          /         %span= adjustment.display_amount.to_html
