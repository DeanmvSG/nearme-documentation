- render_without_left_menu!

.page-banner
  %h1 List a New #{@product_type.name}

= simple_form_for @boarding_form, wrapper: :bs3, url: product_type_product_wizard_index_path(@product_type), html: { multipart: true, id: "boarding_form" }, method: :post do |f|
  %section.list#seller-info
    .container-fluid
      %h2.section-heading Seller Info
      = f.input :store_name, :placeholder => "What do you want to call your store?"
      = f.fields_for :company_address_attributes, f.object.company_address do |a|
        = render 'space_wizard/address', f: a
  = f.simple_fields_for f.object.product_form do |product_form|
    %section.list#new-item
      .container-fluid
        %h2.section-heading List New #{@product_type.name}
        = render 'forms/product_form', f: product_form

    = product_form.simple_fields_for :extra_properties, product_form.object.extra_properties do |properties_form|
      - @form_components.each do |form_component|
        %section.list
          .container-fluid
            %h2.section-heading= form_component.name
            - form_component.form_fields.each do |form_field|
              - model = form_field.keys.first
              - field = form_field[model]
              - if model == 'product'
                - @product_type.custom_attributes.each do |attribute|
                  = draw_attribute_for_form(attribute, properties_form) if field.to_sym == attribute.name.to_sym
                - if (category = @product_type.categories.roots.where(name: field.split(" - ")[1]).first).present?
                  = render partial: 'shared/category', locals: { category: category, f: product_form, categorable: @product_type }

    %section.list#shipping-info{ :data => { 'js-element-identifier' => 'initial_shipping_profiles_section' } }
      .container-fluid
        %h2.section-heading Shipping Info
        .row.shipping_method_block.shipping_method_list
          = render 'dashboard/base/shipping_profiles_list', f: product_form
      .container-fluid
        %a.shipping-profile-top.add_shipping_profile{ :data => { modal: true, href: new_dashboard_shipping_category_path, 'modal-class' => 'shipping_profiles_modal' } }
          =image_tag("themes/buy_sell/icon-cross.png")
          %span
            = t('manage.buy_sell.shipping_profiles.add_new_shipping_profile')


  .submit-bar
    = f.submit "Continue and Preview Listing", class: "btn medium blue"
    = f.submit "Save for Later", class: "btn medium green", name: "boarding_form[draft]"


- content_for :domready do
  new Dashboard.AddressController($("#boarding_form"));
  var boarding_form = new BoardingForm($("#boarding_form"));
  new ShippoFieldsManager(#{raw DimensionsTemplate::UNITS_OF_MEASURE.to_json});

  var selected_categories = #{raw @boarding_form.product_form.category_ids.to_json}
  var display_categories = #{raw @product_type.categories.roots.map(&:id).to_json}
  var categories_path = "#{product_type_categories_path(@product_type)}"
  var jstree_theme_path = "#{stylesheet_path("instance_admin/jstree_themes/apple/style.css")}";
  var category_input_name = "boarding_form[product_form][category_ids][]"
  new CategoriesController($('#boarding_form'));
