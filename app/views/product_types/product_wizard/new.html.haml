- render_without_left_menu!

.page-banner
  %h1
    = t('onboarding_wizard.list_a_new', name: @product_type.name)

= simple_form_for @boarding_form, wrapper: :bs3, url: product_type_product_wizard_index_path(@product_type), html: { multipart: true, id: "boarding_form" }, method: :post do |f|
  = f.simple_fields_for :user, @boarding_form.user do |user_form|
    = f.simple_fields_for :company, @boarding_form.company do |companies_form|
      = f.simple_fields_for f.object.product_form do |product_form|
        = product_form.simple_fields_for :extra_properties, product_form.object.extra_properties do |properties_form|
          = product_form.input :id, :as => :hidden if product_form.object.product.persisted?
          - @form_components.each do |form_component|
            - data_hash ||= nil
            - if form_component.form_fields.include?({ 'product' => 'shipping_info' })
              - data_hash = { 'js-element-identifier' => 'initial_shipping_profiles_section' }
            %section.list{ data: data_hash }
              .container-fluid
                %h2.section-heading= form_component.name

                - form_component.form_fields.each do |form_field|
                  - model = form_field.keys.first
                  - field = form_field[model]
                  - if model == 'user'
                    = render :partial => 'registrations/attributes', :locals => { f: user_form, only_inputs: [field.to_sym], country: @country }
                  - elsif model == 'company'
                    = render partial: 'company_form', locals: { f: companies_form, company: companies_form.object, only_inputs: [ field.to_sym ] }
                  - elsif model == 'product'
                    = render 'forms/product_form', f: product_form, properties_form: properties_form, only_inputs: [ field.to_sym ], form_fields: form_component.form_fields

  .submit-bar
    = f.submit t('onboarding_wizard.continue_and_preview_listing'), class: "btn medium blue"
    = f.submit t('onboarding_wizard.save_for_later'), class: "btn medium green", name: "boarding_form[draft]"


- content_for :domready do
  new Dashboard.AddressController($("#boarding_form"));
  var boarding_form = new BoardingForm($("#boarding_form"));
  new ShippoFieldsManager(#{raw DimensionsTemplate::UNITS_OF_MEASURE.to_json});
  new CategoriesController($('#boarding_form'));
