= render :layout => 'wizard_layout', :locals => { :step => 1 } do
  - title "List your #{current_instance.bookable_noun}"

  = simple_form_for @company, :url => space_wizard_list_url, :validate => false, :html => { :class => "form-horizontal new_company", :multipart => true, :id => 'list-space-flow-form' } do |f|

    = render :partial => 'companies/company_form', :locals => { :f => f, :company => @company, :only_inputs => [ :name, :industries ] }

    = f.simple_fields_for :locations, @location do |locations_form|

      = render :partial => 'locations/location_form', :locals => { :f => locations_form, :location => @location, :only_inputs => [ :description, :address, :location_type, :phone ] }

      = locations_form.simple_fields_for :listings, @listing do |listings_form|

        - content_for :currency do
          = render :partial => 'locations/location_form', :locals => { :f => locations_form, :location => @location, :only_inputs => [ :currency ] }

        = render 'listings/listing_form',
                 :f => listings_form,
                 :listing => @listing,
                 :photo_input_name_prefix => "company[locations_attributes][0][listings_attributes][0]",
                 :only_inputs => [ :name, :description, :listing_type, :quantity, :price, :photos ],
                 photos: @photos

    .user-fields
      = simple_fields_for current_user do |uf|
        = render 'registrations/phone_fields', :f => uf, :locals => { :country => @country }
      .actions
        = f.submit "List my #{current_instance.bookable_noun}", :disable_with => 'Creating...'

- content_for :script do
  :javascript
    $(function() {
      new SpaceWizardSpaceForm($('form.new_company'))
      new Dashboard.LocationController($('#list-space-flow-form'))
      new Dashboard.ListingController($('#list-space-flow-form'))
      new PhoneNumbers.FieldsForm($('.user-fields'))
    });

