- no_footer!
- no_listing_buttons!
- title "List your #{platform_context.bookable_noun}"

.row-fluid
  .span8.offset2
    %h1
      %span List Your First #{platform_context.bookable_noun}

#space_wizard.row-fluid
  .span8.offset2
    = simple_form_for @user, :url => space_wizard_list_url, :validate => false, :html => { :class => "form-horizontal new_company", :multipart => true, :id => 'list-space-flow-form' }, method: :post do |f|

      - if platform_context.instance.user_info_in_onboarding_flow?
        %h2= t('registrations.tell_us')
        %br
        .box
          = render :partial => 'registrations/attributes', :locals => { f: f, only_inputs: platform_context.instance.user_required_fields, country: @country }
          = render partial: 'registrations/custom_attributes', locals: { f: f }
      - elsif f.object.user_instance_profiles.first.instance_profile_type.present? && f.object.user_instance_profiles.first.instance_profile_type.custom_attributes.count > 0
        %h2= t('registrations.tell_us')
        = render partial: 'registrations/custom_attributes', locals: { f: f }
        = render :partial => 'approval_requests/form', :locals => { f: f }
      - else
        = render :partial => 'approval_requests/form', :locals => { f: f }

      = f.simple_fields_for :companies, @user.companies.first do |companies_form|
        - if platform_context.instance.skip_company?
          = companies_form.hidden_field :name
        - else
          %h2 Tell us a little about your company
          %br
          .box
            = render :partial => 'companies/company_form', :locals => { :f => companies_form, :company => companies_form.object, :only_inputs => [ :name, :industries ] }

        = companies_form.simple_fields_for :locations, @user.companies.first.locations.first do |locations_form|
          %h2
            Where is your
            #{platform_context.bookable_noun}
            located?
          %br
          .box
            = render :partial => 'locations/location_form', :locals => { :f => locations_form, :location => locations_form.object, :only_inputs => [ :name, :description, :address, :location_type, :phone ] }


          = locations_form.simple_fields_for :listings, @user.companies.first.locations.first.listings.first do |listings_form|

            - content_for :currency do
              = render :partial => 'locations/location_form', :locals => { :f => locations_form, :location => locations_form.object, :only_inputs => [ :currency ] }
            %h2
              Please tell us about the
              #{platform_context.bookable_noun}
              you're listing
            %br
            .box
              = render 'listings/listing_form',
                       :f => listings_form,
                       :listing => listings_form.object,
                       :photo_input_name_prefix => "[user][companies_attributes][0][locations_attributes][0][listings_attributes][0]",
                       :only_inputs => [ :name, :description, :listing_type, :custom_type, :quantity, :price, :photos ],
                       photos: @photos

      .user-fields
        %h2 And finally, your contact information
        %br
        .box
          = render 'registrations/phone_fields', :f => f, :locals => { :country => @country }
        .actions
          .centerbuttons
            = f.submit "Submit", :name => "commit", data: { disable_with: 'Creating...' }, :class => "listmydesk btn-medium"
            = f.submit "Save as draft", :name => "save_as_draft", data: { disable_with: 'Saving...' }, :class => "saveasdraft btn-gray btn-medium"

- content_for :script do
  :javascript
    $(function() {
      new SpaceWizardSpaceForm($('form.new_company'))
      new Dashboard.LocationController($('#list-space-flow-form'))
      new Dashboard.ListingController($('#list-space-flow-form'))
      new PhoneNumbers.FieldsForm($('.user-fields'))
    });
