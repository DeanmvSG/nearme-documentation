
<article class="workplace">

  <div class="grid_8 alpha">

    <div class="grid_5 alpha">
      <h1 class="tk-adelle"><%= @workplace.name %></h1>
      <%= content_tag(:p, link_to(@workplace.url, @workplace.url)) if @workplace.url %>
      <address><%= @workplace.formatted_address || @workplace.address %></address>
    </div>
    
    <% if @workplace.creator %>
      <div class="creator" class="grid_3 omega">
        <%= image_tag @workplace.creator.gravatar_url, :class => 'avatar', :title => @workplace.creator.name, :alt => @workplace.creator.name %>
        <small>Created By</small><br/>
        <%= @workplace.creator.name %>
      </div>
    <% end %>

  </div>

  <% if @workplace.created_by?(current_user) %>
    <div class="grid_4 omega">
      <%= link_to "Edit Workplace", edit_workplace_path(@workplace) %>
      <%= link_to "Manage Workplace Photos", workplace_photos_path(@workplace) %>
    </div>
  <% end %>

  <section class="details grid_8 alpha">
    
    <div class="business_description">
      <%= raw @workplace.company_description_html %>
    </div>

    <h2 class="tk-chaparral-pro">Availability</h2>
    <%= render :partial => "availability", :locals => {:workplace => @workplace, :weeks => 3} %>

    <% if @workplace.description? %>
      <h2 class="tk-chaparral-pro">Extra Info</h2>
      <p>
        <strong>Booking Confirmation Required:</strong>
        <%= @workplace.confirm_bookings? ? "Yes" : "No" %>
      </p>
      <p><%=raw @workplace.description_html %></p>
    <% end %>

    <h2 class="tk-chaparral-pro">Latest Activity</h2>
    <dl>
      
    </dl>
    <% if @feeds.any? %>
      <% @feeds.each do |feed| %>
        <div class="feed_item">
          <%= image_tag feed.user.gravatar_url, :style => "margin-right: 10px", :align => "left" %>
          <%= render :partial => "feeds/#{feed.activity}", :locals => { :feed => feed } %><br/>
          <small><%= time_ago_in_words(feed.created_at) %> ago</small>
        </div>
      <% end %>
    <% else %>
      <p>No activity has been generated yet.</p>
    <% end %>
  </section>

  <aside class="grid_4 omega">
    <section id="photos" class="fancy-photos">
      <h2 class="tk-chaparral-pro">Photos</h2>
      <% if @workplace.photos.any? %>
          <ul>
          <% @workplace.photos.each do |photo| %>
            <li>
              <%= link_to photo.large.url, :title => photo.description, :rel => "photos" do %>
                <%= image_tag(photo.thumb.url, :alt => photo.description) %>
              <% end %>
            </li>
          <% end %>
          </ul>
      <% else %>
        <p>Aww noo. There are no photos uploaded yet.</p>
      <% end %>
    </section>
    <section>
      <h2 class="tk-chaparral-pro">Location</h2>
      <div id="map" style="height: 200px" class="google-map"></div>
      <%= link_to "Open in Google Maps", "http://maps.google.com?q=#{@workplace.address}", :target => "_blank" %>
      <details>
        <%= simple_format @workplace.address %>
      </details>
    </section>

  </aside>

</article>

<% content_for :script do -%>
<script type="text/javascript">
  $(function(){
    $("td.day details.availability a").click(function(e){
      e.stopPropagation();
      var overlay = $("body").overlay({ ajax: $(this).attr("href"), position: { my: "top", at: "bottom", of: $(this).parents('td') }, html: 'Working&hellip;', 'class': "context" });
      $(".overlay-container a.cancel").live("click", function(e){
        e.stopPropagation();
        $(".overlay-container").overlay('close');
        return false;
      });
      return false;
    });
    
    var latlng = new google.maps.LatLng(<%= @workplace.latitude %>, <%= @workplace.longitude %>);
    var myOptions = {
      zoom: 13,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      mapTypeControl: false
    };
    var map = new google.maps.Map(document.getElementById("map"), myOptions);
    var image = "<%= image_path("marker.png") %>";
    var beachMarker = new google.maps.Marker({
      position: latlng,
      map: map,
      icon: image
    });
  });
</script>
<% end %>
