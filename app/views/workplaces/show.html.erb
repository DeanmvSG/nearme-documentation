
<article class="workplace">

  <div class="grid_8 alpha">
    <h1 class="tk-adelle"><%= @workplace.name %></h1>
  </div>

  <% if @workplace.created_by?(current_user) %>
    <div class="grid_4 omega">
      <%= link_to "Edit Workplace", edit_workplace_path(@workplace) %>
      <%= link_to "Manage Workplace Photos", workplace_photos_path(@workplace) %>
    </div>
  <% end %>

  <section class="details grid_8 alpha">

    <p class="em"><%=raw @workplace.company_description_html %></p>

    <hr />

    <h2>Availability</h2>
    <%= render :partial => "availability", :locals => {:workplace => @workplace} %>

    <hr />

    <% if @workplace.description? %>
      <h2>Extra Info</h2>
      <p>
        <strong>Booking Confirmation Required:</strong>
        <%= @workplace.confirm_bookings? ? "Yes" : "No" %>
      </p>
      <p><%=raw @workplace.description_html %></p>
    <% end %>

    <h2>Latest Activity</h2>
    <% if @feeds.any? %>
      <% @feeds.each do |feed| %>
        <div class="feed_item">
          <%= image_tag feed.user.picture_url, :style => "margin-right: 10px", :align => "left" if feed.try(:user).try(:picture_url) %>
          <%= render :partial => "feeds/#{feed.activity}", :locals => { :feed => feed } %><br/>
          <small><%= time_ago_in_words(feed.created_at) %> ago</small>
        </div>
      <% end %>
    <% else %>
      <p>No activity has been generated yet.</p>
    <% end %>
  </section>

  <aside class="grid_4 omega">
    <% if @workplace.photos.any? %>
      <section id="photos" class="fancy-photos">
        <h2>Photos</h2>
        <ul>
        <% @workplace.photos.each do |photo| %>
          <li>
            <%= link_to photo.large.url, :title => photo.description, :rel => "photos" do %>
              <%= image_tag(photo.thumb.url, :alt => photo.description) %>
            <% end %>
          </li>
        <% end %>
        </ul>
      </section>
    <% end %>
    <section>
      <h2>Location</h2>
      <div id="map" style="height: 200px" class="google-map"></div>
      <%= link_to "Open in Google Maps", "http://maps.google.com?q=#{@workplace.address}", :target => "_blank" %>
      <details>
        <%= simple_format @workplace.address %>
      </details>
    </section>
  </aside>

</article>

<script type="text/javascript">
  $(document).ready(function() {
      var latlng = new google.maps.LatLng(<%= @workplace.latitude %>, <%= @workplace.longitude %>);
      var myOptions = {
        zoom: 13,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        mapTypeControl: false
      };
      var map = new google.maps.Map(document.getElementById("map"), myOptions);
      var image = "<%= image_path("drawer-open.png") %>";
      var beachMarker = new google.maps.Marker({
        position: latlng,
        map: map,
        icon: image
      });
  });
</script>
