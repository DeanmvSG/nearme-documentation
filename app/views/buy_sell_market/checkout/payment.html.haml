.checkout-wizard
  .page-wrapper
    = render 'header'

    = simple_form_for @order, url: wizard_path do |f|
      %section.checkout-form
        .container-fluid
          %h2= t 'buy_sell_market.checkout.labels.order_summary'
          %table.payment-summary
            %thead
              %th= t 'buy_sell_market.checkout.labels.item'
              %th= t 'buy_sell_market.checkout.labels.price'
              %th= t 'buy_sell_market.checkout.labels.qty'
              %th= t 'buy_sell_market.checkout.labels.total'

            %tbody
              - @order.line_items.each do |item|
                %tr
                  %td= item.name
                  %td= item.price
                  %td= item.quantity
                  %td= item.total

          .divider

          %table.payment-totals{align: 'right'}
            %tr
              %td= t 'buy_sell_market.checkout.labels.subtotal'
              %td= humanized_money_with_cents_and_symbol @order.monetize(@order.item_total)
            %tr
              %td= t 'buy_sell_market.checkout.labels.shipping'
              %td= humanized_money_with_cents_and_symbol @order.monetize(@order.shipment_total)
            %tr
              %td= t 'buy_sell_market.checkout.labels.tax'
              %td= humanized_money_with_cents_and_symbol @order.monetize(@order.additional_tax_total)
            %tr
              %td= t 'buy_sell_market.checkout.labels.service_fee'
              %td= humanized_money_with_cents_and_symbol @order.service_fee_amount_guest
            %tr
              %td.total= t 'buy_sell_market.checkout.labels.total2'
              %td.total= humanized_money_with_cents_and_symbol @order.total_amount_to_charge

      - if platform_context.instance.documents_upload_enabled?
        %section.checkout-form
          .container-fluid
            %h2= t 'buy_sell_market.checkout.labels.required_documents'
            = t 'buy_sell_market.checkout.labels.the_following_documents'
            .document-requirements
              = f.simple_fields_for :payment_documents do |pd|
                = pd.hidden_field :id
                = pd.hidden_field :user_id
                .row-fluid
                  .span3.title
                    = pd.simple_fields_for :payment_document_info do |pdi|
                      = pdi.hidden_field :attachment_id
                      = pdi.hidden_field :document_requirement_id
                      = pdi.object.document_requirement.label
                  .span9.upload{ 'data-upload' => true }
                    = pd.input :file, as: :file, label: false, input_html: { hidden: true }
                    - if pd.object.file.present?
                      %button{ type: 'button', class: 'btn-upload-payment-document', 'data-upload-document' =>true }
                        = t 'buy_sell_market.checkout.labels.choose_another_file'
                      %span{ "data-file-name" => true }
                        = link_to pd.object.file.file_name, pd.object.file.url, target: '_blank'
                    - else
                      %button{ type: 'button', class: 'btn-upload-payment-document', 'data-upload-document' =>true }
                        = t 'buy_sell_market.checkout.labels.choose_file'
                      %span{ "data-file-name" => true }
                        = t 'buy_sell_market.checkout.labels.no_file_chosen'

      %section.checkout-form#credit-card-select
        .container-fluid
          %h2 Payment Information
          - if @order.billing_authorization.nil?
            = render 'checkout_credit_card_fields', f: f
          - else
            Credit Card has been already authorized. Please proceed.

      = render partial: 'checkout_buttons', locals: { form: f }

- content_for :domready do
  new PaymentController($('.checkout-wizard'))
