.dash-head.clearfix
  %p #{t('buy_sell_market.checkout.labels.order_details')} - #{@order.number}

.dash-body
  .action-row
    - if !@order.approved? && !@order.canceled?
      = link_to approve_dashboard_company_orders_received_path(@order),
          data: { confirm: 'Are you sure you want to approve this order?' } do
        .btn.blue Approve Order

    - if @order.allow_cancel? && @order.payment_state != 'paid'
      = link_to cancel_dashboard_company_orders_received_path(@order),
          data: { confirm: 'Are you sure you want to cancel this order?' } do
        .btn.red Cancel Order

    - if @order.canceled?
      = link_to resume_dashboard_company_orders_received_path(@order),
          data: { confirm: 'Are you sure you want to resume this order?' } do
        .btn.blue Resume Order

  .divider

  %table.order-header
    %thead
      %th= t 'buy_sell_market.checkout.labels.billing_address'
      %th= t 'buy_sell_market.checkout.labels.shipping_address'
      %th= t 'buy_sell_market.checkout.labels.shipping_method'
      %th= t 'buy_sell_market.checkout.labels.payment'

    %tbody
      %tr
        %td= @order.bill_address.full_name
        %td= @order.ship_address.full_name
        %td{rowspan: 6}
          - @order.shipments.each do |shipment|
            From
            %strong= shipment.stock_location.name
            via
            %br
            %strong=shipment.selected_shipping_rate.name
            %br

        %td
          - if @charge_info && @charge_info.response['card']
            #{t('buy_sell_market.checkout.labels.ending_in')} #{@charge_info.response['card']['last4']}
            #{@charge_info.response['card']['name']}

          - unless @order.canceled?
            - @order.payments.valid.each do |payment|
              - if payment.completed?
                .btn.gray.disabled Payment captured
              - else
                = link_to capture_dashboard_company_orders_received_payment_path(@order.number, payment.id),
                    data: { confirm: 'Are you sure you want to capture payment for this order?' } do
                  .btn.blue Capture


      %tr
        %td= @order.bill_address.address1
        %td= @order.ship_address.address1
        %td
        %td

      %tr
        %td= @order.bill_address.address2
        %td= @order.ship_address.address2
        %td
        %td

      %tr
        %td= @order.bill_address.city
        %td= @order.ship_address.city
        %td
        %td

      %tr
        %td= @order.bill_address.country.name
        %td= @order.ship_address.country.name
        %td
        %td

      %tr
        %td= @order.bill_address.state.abbr
        %td= @order.ship_address.state.abbr
        %td
        %td

      %tr
        %td= @order.bill_address.zipcode
        %td= @order.ship_address.zipcode
        %td
        %td

  .divider

  %h2 Shipping
  %table.payment-summary
    %thead
      %tr
        %th NUMBER
        %th STATE
        %th STOCK LOCATION
    %tbody
      - @order.shipments.each do |shipment|
        %tr
          %td= shipment.number
          %td= shipment.state
          %td= shipment.stock_location.name
          %td
            - if shipment.ready?
              = link_to ship_dashboard_company_orders_received_shipment_path(@order.number, shipment),
                  data: { confirm: 'Are you sure you want to ship this package?' } do
                .btn.blue Mark as Shipped

  .divider

  %h2= t 'buy_sell_market.checkout.labels.order_summary'
  %table.payment-summary
    %thead
      %th= t 'buy_sell_market.checkout.labels.item'
      %th= t 'buy_sell_market.checkout.labels.price'
      %th= t 'buy_sell_market.checkout.labels.qty'
      %th= t 'buy_sell_market.checkout.labels.total'

    %tbody
      - @order.line_items.each do |item|
        %tr
          %td= item.name_with_link
          %td= item.price
          %td= item.quantity
          %td= item.total

  .divider

  %table.payment-totals{align: 'right'}
    %tr
      %td= t 'buy_sell_market.checkout.labels.subtotal'
      %td= humanized_money_with_cents_and_symbol @order.monetize(@order.item_total)
    %tr
      %td= t 'buy_sell_market.checkout.labels.shipping'
      %td= humanized_money_with_cents_and_symbol @order.monetize(@order.shipment_total)
    %tr
      %td= t 'buy_sell_market.checkout.labels.tax'
      %td= humanized_money_with_cents_and_symbol @order.monetize(@order.additional_tax_total)
    %tr
      %td= t 'buy_sell_market.checkout.labels.service_fee'
      %td= humanized_money_with_cents_and_symbol @order.service_fee_amount_guest
    %tr
      %td.total= t 'buy_sell_market.checkout.labels.total2'
      %td.total= humanized_money_with_cents_and_symbol @order.total_amount_to_charge

  .clearfix
