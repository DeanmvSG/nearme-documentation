{% assign form_object = f %}
<input type='hidden' value='{{ params.edit_mode}}' name='edit_mode' />

{% if merchant_account.persisted? %}
  <div class="alert alert-warning">
    {{ "dashboard.merchant_account." | append:merchant_account.state | translate }}
  </div>
  {% input id, as: hidden %}
{% endif %}

{% if merchant_account.all_errors %}
  <div class="errors-global">
    <ul>
      {% for error in merchant_account.all_errors %}
        <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

{% if merchant_account.verified? and params.edit_mode == blank %}

 <h3>{{ 'dashboard.merchant_account.' | append: merchant_account.state | translate }}</h3>
    <div class='btn-group pull-right'>
      <a href='?edit_mode=true' class='btn btn-blue'>Edit</a>
    </div>

  <table class='table table-simple'>
    <tr>
      <td>{{'dashboard.merchant_account.account_type' | translate }}</td>
      <td>{{ merchant_account.account_type | capitalize }}</td>
    </tr>
    <tr>
      <td>{{'dashboard.merchant_account.first_name' | translate }}</td>
      <td>{{ merchant_account.first_name }}</td>
    </tr>
    <tr>
      <td>{{'dashboard.merchant_account.last_name' | translate }}</td>
      <td>{{ merchant_account.last_name }}</td>
    </tr>
    <tr>
      <td>{{'dashboard.merchant_account.bank_account_number' | translate }}</td>
      <td>{{ merchant_account.bank_account_number }}</td>
    </tr>
    <tr>
      <td>{{'dashboard.merchant_account.dob' | translate }}</td>
      <td>{{ merchant_account.owners.first.dob_date }}</td>
    </tr>
  </table>

{% else %}
  <h2>{{ 'dashboard.merchant_account.header' | translate }}</h2>
  {% if merchant_account.persisted? %}
    <h3>{{ "dashboard.merchant_account." | append: merchant_account.state | translate }}</h3>
  {% endif %}

{% comment %}  {% fields_for owners %}
    {% include 'dashboard/company/merchant_accounts/stripe_connect_owner_fields', owners: owners, merchant_account: merchant_account %}
  {% endfields_for %}

  <div class='owners'>
    <div class='links'>
      {% assign link_label = 'dashboard.merchant_account.add_owner' | translate %}
      {% link_to_add_association label: @link_label, asocciation: owners, partial: dashboard/company/merchant_accounts/stripe_connect_owner_fields, render_options-locals: merchant_account %}
    </div>
  </div>
  <br />
  <h3>{{ 'dashboard.merchant_account.main_owner_detail' | translate }}</h3>
{% endcomment %}

  {% input :account_type, prompt: 'translate', required: true,  input_html-data-account-type: 'true', collection: @merchant_account.account_types %}
  {% if merchant_account.supported_currencies.size > 1 %}
    {% input currency, required: true, collection: @merchant_account.supported_currencies, prompt: 'translate' %}
  {% endif %}

  {% input bank_routing_number, required: true %}
  {% input bank_account_number, required: true %}
  {% input first_name, required: true %}
  {% input last_name, required: true %}
  {% if 'US CA' contains  merchant_account.iso_country_code %}
    {% input personal_id_number, required: true %}
    {% input business_tax_id, required: true, wrapper_html-data-account-type: 'company' %}
  {% endif%}

  {% fields_for owners  %}
    <div class='datetimepicker' style='position: relative'>
      {% assign owner = merchant_account.owners.first %}
      {% assign date_format = owner.date_format_readable %}
      {% input dob_formated, form: owners, required: true, input_html-data-date-picker: 'true', input_html-data-date-format: @date_format, disabled: @merchant_account.verified? %}
    </div>
    {% if 'US CA' contains  merchant_account.iso_country_code %}
      {% input document, form: owners, required: true %}
    {% endif %}
  {% endfields_for %}

  {% fields_for current_address %}
    <div class='fields location' data-address-field>
      {% input address, form: current_address, input_html-data-address-input: 'true', input_html-data-behavior: 'address-autocomplete', required: true %}
      <div class="map">
        <div class="map-container"></div>
      </div>
    </div>
  {% endfields_for %}

  <div class="{% if merchant_account.tos_error %}has-error{%endif%}">
    <label>
      <input name="merchant_account[tos]" type="hidden" value="0">
      <input type="checkbox" value="1" name="merchant_account[tos]" id="merchant_account_tos" {% if params.merchant_account.tos == '1' %}checked='checked'{%endif%}>
      Payment processing services for {{ platform_context.lessee }} on {{ platform_context.name }} are provided by Stripe and are subject to the <a href="https://stripe.com/connect/account-terms" target="_blank">Stripe Connected Account Agreement</a>, which includes the <a href="https://stripe.com/us/terms" target="_blank">Stripe Terms of Service</a> (collectively, the “Stripe Services Agreement”). By agreeing to [this agreement / these terms / etc.] or continuing to operate as a guest on Upside of Talent, you agree to be bound by the Stripe Services Agreement, as the same may be modified by Stripe from time to time. As a condition of {{ platform_context.name }} enabling payment processing services through Stripe, you agree to provide {{ platform_context.name }} accurate and complete information about you and your business, and you authorize {{ platform_context.name }}  to share it and transaction information related to your use of the payment processing services provided by Stripe.
    </label>
    <span class="help-block">{{ merchant_account.tos_error }}</span>
  </div>
  <div class="panel form-actions">
    <div class="panel-body">
      <input type="submit" name="commit" value="{{'payouts.buttons.save' | translate }}">
    </div>
  </div>
{% endif %}

