- title "Data Upload"

= show_manage_navigation(:data_upload)

.row-fluid
  .span8.offset2
    .box
      %header
        %ul.location-and-listings
          %li.location
            Manage Data Uploads for #{@transactable_type.name}
      %ul#data-uploads.location-and-listings
        %li.listing.action-buttons
          .right
            = link_to 'New Data Upload', new_manage_transactable_type_data_upload_path(@transactable_type), class: 'btn btn-medium btn-white'
            = link_to 'Download Current Data', download_current_data_csv_manage_transactable_type_data_uploads_path(@transactable_type), class: 'btn btn-medium btn-white'
            = link_to 'Download CSV Template', download_csv_template_manage_transactable_type_data_uploads_path(@transactable_type), class: 'btn btn-medium btn-white'
          .clearfix
        %li.listing
          .span3
            = t('data_upload.manage.csv_file')
          .span4
            = t('data_upload.manage.review_file')
          .span2
            = t('data_upload.manage.import')
          .span2.state
            = t('data_upload.manage.status')
          .span1

          .clearfix
        = render partial: 'data_upload', collection: @data_uploads
      = will_paginate @data_uploads

- content_for :script do
  :javascript
    $(function() {
      new Dashboard.DataUploadController(
        $('#data-uploads'),
        '#{status_manage_transactable_type_data_uploads_path(@transactable_type)}',
        #{@data_uploads.select(&:should_be_monitored?).inject({}) { |hash, du| hash[du.id] = { state: du.state,  url: manage_transactable_type_data_upload_path(@transactable_type, du) }; hash }.to_json }
      )
    });

