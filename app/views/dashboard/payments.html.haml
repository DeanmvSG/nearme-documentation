- title "Payments"

%section#payments
  .row-fluid
    .span8.offset2
      %h1
        Payments
      .box
        - if @charges.empty?
          %p No charges in the last 7 days, sorry
        - else
          .charges-graph
            .charges-total.right
              - group_charges(@last_week_charges).each do |currency, values|
                .total-number.left
                  = "#{currency_content_tag(currency, values.sum { |k, v| v.amount }, :span, { :rel => false })}".html_safe
              total
            %canvas#charge-chart

          .charges-details
            - @charges.each do |charge|
              .clearfix.charge-line-item
                .left
                  = "#{currency_content_tag(charge.currency, charge.price, :span, { :rel => false })} - #{charge.reference.listing.location.name}".html_safe
                .right
                  = charge.created_at.strftime('%Y/%m/%d %H:%M:%S')

            = will_paginate @charges

- content_for :domready do
  new ChartWrapper.Line($('#charge-chart'), #{values_for_chart(@last_week_charges).to_json.html_safe}, #{labels_for_chart.to_json.html_safe})
