%hr
%legend Payment Gateways
.row-fluid
  .controls.controls-row
    = select_tag :payment_gateway, options_from_collection_for_select(@payment_gateways, :id, :name), class: "payment-gateway-select"
    %hr

    = f.simple_fields_for :instance_payment_gateways, @instance.instance_payment_gateways.find_or_build do |f|
      %div{:class => "payment-gateway-option payment-gateway-#{f.object.payment_gateway_id} hidden"}
        %h3= "Settings for: #{f.object.name}"

        = f.input :payment_gateway_id, as: :hidden, input_html: { value: f.object.payment_gateway_id }
        .row-fluid
          .span6.control-group
            %h5 Live Settings
            = f.fields_for :live_settings do |live|
              - f.object.live_settings.each do |k, v|
                - if k.to_sym == :currency
                  = live.input k.to_sym, as: :currency, prompt: currency_name(v), input_html: { class: 'input-block-level' }
                - else
                  = live.input k.to_sym, as: :string, input_html: { value: v, class: 'input-block-level' }
          .span6.control-group
            %h5 Test Settings
            = f.fields_for :test_settings do |test|
              - f.object.test_settings.each do |k, v|
                - if k.to_sym == :currency
                  = test.input k.to_sym, as: :currency, prompt: currency_name(v), input_html: { class: 'input-block-level', value: "USD" }
                - else
                  = test.input k.to_sym, as: :string, input_html: { value: v, class: 'input-block-level' }
