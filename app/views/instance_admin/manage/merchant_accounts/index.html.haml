.content-container
  %h4
    = t("instance_admin.manage.merchant_accounts")

  .row
    = form_tag '', :method => 'get', enforce_utf8: :false do
      .row
        .col-xs-3
          = select_tag :payment_gateway_id, options_from_collection_for_select(@payment_gateways, "id", "name", params[:payment_gateway_id]), include_blank: "All Payment Gateways", class: "selectpicker"

        .col-xs-2
          = select_tag :state, options_for_select(MerchantAccount.state_machine.states.map{|s| [s.name.capitalize, s.name] } , params[:state]), include_blank: "In all states", class: "selectpicker"
        .col-xs-1
          = select_tag :mode, options_for_select([["Live", 'live'], ["Test", 'test']], params[:mode]), class: "selectpicker"
        .col-xs-2
          = submit_tag "Search", :name => nil, class: 'btn btn-light'
    .table-container.col-xs-12
      %table.table
        %thead
          %tr
            %th= t('instance_admin.manage.merchant_account.company')
            %th= t('instance_admin.manage.merchant_account.state')
            %th= t('instance_admin.manage.merchant_account.payment_gateway')
            %th= t('instance_admin.manage.merchant_account.created_at')
            %th= t('instance_admin.manage.merchant_account.action')
            %th= t('instance_admin.manage.merchant_account.details')

        - @merchant_accounts.each do |merchant_account|
          %tr
            %td
              - if merchant_account.company.present?
                = merchant_account.company.name
              - else
                = "(#{t('instance_admin.deleted')})"
            / %td= merchant_account.payable.user.try(:name) if merchant_account.payable
            %td= merchant_account.state.try(:capitalize)
            %td= merchant_account.payment_gateway.try(:name)
            %td= l(merchant_account.created_at, format: :long)
            %td
              - if merchant_account.verified?
                = link_to 'Void account', void_instance_admin_manage_merchant_account_path(merchant_account), data: { confirm: "Are you sure you want to void this Merchant? This acction is irreversible!"}
                %span= '| '
                = link_to 'Mark as pending', pending_instance_admin_manage_merchant_account_path(merchant_account), data: { confirm: "Are you sure you want to mark this merchant as pending?"}
              - else
                none

            %td= link_to 'Details',  instance_admin_manage_merchant_account_path(merchant_account)

.row
  .text-container
    .pull-right
      = will_paginate @merchant_accounts

