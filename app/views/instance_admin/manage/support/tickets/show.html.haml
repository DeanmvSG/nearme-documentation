.support
  .row-fluid
    .controls.controls-row
      .left
        %legend= "Request ##{@ticket.id}"
      .right
        %legend= "#{@ticket.state}"
        %legend
          =select_tag("user[assigned_to_id]", options_for_select(@admins.map{|a| [a.name, a.id]}, @ticket.assigned_to.try(:id)), prompt: 'UNASSIGNED')
        %legend.status

  %br

  %h2= @message.subject

  - if @ticket.open?
    .form.message-form
      = simple_form_for(@message, url: instance_admin_manage_support_ticket_ticket_messages_path(@ticket)) do |f|
        = f.input :message, as: :text, class: 'textarea', :input_html => { :rows => 10 }
        .attachments{:'data-attachment-list' => true }
          = render partial: 'support/ticket_message_attachments/attachment', collection: @message.attachments, as: :ticket_message_attachment
        .right
          = render partial: 'support/ticket_message_attachments/form', locals: { f: f }
          = f.submit 'Update', class: 'btn btn-form'
          = f.submit 'Update and Resolve', class: 'btn btn-form'

      = simple_form_for @ticket.attachments.build, url: support_ticket_ticket_message_attachments_path(@ticket), html: { class: 'hidden', :'data-attachment-form'=> true } do |f|
        = f.input :file, as: :file, input_html: { data: { file: true } }
  = render partial: 'ticket_message', collection: @ticket.messages, spacer_template: 'spacer'

= content_for :script do
  = render 'shared/modal'
  :javascript
    $('abbr.timeago').timeago();
    new SupportAssigner($('#user_assigned_to_id'));
    new Support.TicketMessageController($('.message-form').eq(0))
