- legacy false
- title location_to_title(@location)

- content_for :meta_description do
  = "Read reviews #{@location.reviews.count} and book at #{@location.company.try(:name)}. #{@location.description.try(:truncate, 28)}"

- content_for :hero do
  %article#space
    .container-fluid
      .row-fluid.padding-row
        .span12.nested
          %h1 #{@location.company.name} at #{@location.street}

      .container-row
        .two-thirds.column.left
          = render 'locations/location_photos', location: @location

          .padding-row

          %article.location.listing
            %h2
              The location
              - if current_user.try(:admin)
                = link_to login_as_admin_user_path(@location.creator, :return_to => edit_manage_location_path(@location)), :method => :post, :confirm => "This will log you out and re-log you in as location creator" do
                  %span.ico-edit
            %p= @location.description

            .amenities-block
              .amenities-header
                %h3 Hours
                %a{href: '#industries'}
                  %h3 Hours
                  %span.ico-chevron-right
              .amenities-container
                .row-fluid.amenities-row
                  .span3
                    = pretty_availability_sentence(@location.availability)

            = render 'locations/amenities', amenities_owner: @location

            = render 'locations/company', location: @location

        .one-third.column.left
          .toggleable-booking-modules
            - @listings.each_with_index do |listing, index|
              = render 'locations/listings/booking', listing: listing, collapsed: index > 0
              .padding-row

          -if @location.administrator
            = render 'locations/administrator', administrator: @location.administrator

          = render 'locations/google_map', location: @location 

          .padding-row
          = render 'locations/social_buttons', location: @location

.clearfix.padding-row

- content_for :script do
  :javascript
    // Initialize the ui controller
    $(function() {
      new Space.Controller(
        $('article#space'),
        {
          bookings: {
            listings: #{raw location_listings_json},

            // Have we returned from setting up a session. If there are bookings, the JS controller
            // will trigger showing the booking confirmation modal.
            returnedFromSession: #{@initial_bookings.present? ? 'true' : 'false'}
          }
        });
      });

- content_for :domready do
  - if @listing && params[:action] == 'ask_a_question' 
    Modal.load('#{new_listing_listing_message_path(@listing)}')
