- location_pretty_availability ||= pretty_availability_sentence(listing.location.availability)
- collapsed ||= false
.booking-module-container{:class => "#{(listing.hourly_reservations? ? 'booking-hourly' : 'booking-daily')} #{collapsed ? " collapsed" : ""}", :'data-toggleable-booking-module' => true}
  .booking-module
    .booking-header
      %a.toggleable-booking-trigger{:href => location_path(listing.location, listing), :'data-booking-trigger' => true}
        %span.booking-listing-name= mask_phone_and_email_if_necessary(listing.name)
        %span.pull-right
          %i.ico-chevron-down
          %i.ico-chevron-right
    .booking-price-info
      %span= price_information(listing)
      %span.pull-right
        = listing.listing_type
    .booking-body
      .booking-price
        - if listing.free?
          %span.label
            Free
        - elsif listing.hourly_reservations?
          %span.label
            - unless listing.hourly_price.to_f.zero?
              = "#{money_without_cents_and_with_symbol(listing.hourly_price)}"
            - else
              = '-'
            %span.period   PER HOUR
        - else
          - if listing.transactable_type.pricing_options['daily']
            %span.label
              - unless listing.daily_price.to_f.zero?
                = "#{money_without_cents_and_with_symbol(listing.daily_price)}"
              - else
                = '-'
              %span.period   PER DAY

          - if listing.transactable_type.pricing_options['weekly']
            %span.label
              - unless listing.weekly_price.to_f.zero?
                = "#{money_without_cents_and_with_symbol(listing.weekly_price)}"
              - else
                = '-'
              %span.period   PER WEEK

          - if listing.transactable_type.pricing_options['monthly']
            %span.label
              - unless listing.monthly_price.to_f.zero?
                = "#{money_without_cents_and_with_symbol(listing.monthly_price)}"
              - else
                = '-'
              %span.period   PER MONTH

      .clearfix
      - if params[:controller] != 'locations/listings'
        .booking-description
          %h3 Description
          %span= custom_sanitze mask_phone_and_email_if_necessary(listing.description)
          - listing_availability = pretty_availability_sentence(listing.availability)
          - if listing_availability != location_pretty_availability
            .booking-opening-hours
              %h3 Hours
              %span= pretty_availability_sentence(listing.availability)

      .calendar-wrapper.date-start
        .calendar
          %span.ico-calender-end
          %span.calendar-text Start

      - if listing.hourly_reservations?

        .calendar-wrapper.time-picker
          .time
            %span.ico-clock
            %span.time-text 9:00am

      - else
        .calendar-wrapper.date-end
          .calendar
            %span.ico-calender-start
            %span.calendar-text End

      .clearfix
      .quantity
        %span.resource{:'data-singular' => listing.listing_type, :'data-plural' => listing.listing_type.try(:pluralize)}= listing.listing_type
        = select_tag :quantity, options_for_select(1..listing.quantity), :class => 'quantity'
      .price{class: "#{'hidden' if listing.free?}"}
        Total
        %span #{currency_content_tag(@location.currency, 0.00, :span, { :rel => false })}

      .book
        - registration_url = new_user_registration_path(return_to: location_url(@listing.location, @listing, restore_reservations: true))
        - store_reservation_request_url = store_reservation_request_listing_reservations_path(@listing)
        = form_for :reservation_request, :url => review_listing_reservations_path(listing), html: { id: "reservation_request_form_#{listing.id}" } do |f|
          = hidden_field_tag :listing_id, @listing.id
          = f.hidden_field :quantity
          = f.hidden_field :dates
          = f.hidden_field :start_on
          = f.hidden_field :end_on
          = f.hidden_field :start_minute
          = f.hidden_field :end_minute

          - book_hash = {id:"book-#{listing.id}", class: "btn btn-green btn-large ", rel: "tooltip", :'data-original-title' => "Please select days first", :'data-behavior' => 'reviewBooking', :'data-listing-id' => listing.id, :'data-registration-url' => registration_url, :'data-store-reservation-request-url' => store_reservation_request_url, :'data-user-signed-in' => user_signed_in?, :'data-secured' => (not secure_links?), :'data-force-modal' => false}

          -if listing.has_action?('Request For Quote')
            - book_hash[:class] += (listing.free? ? 'hidden' : 'span6')
            - rfq_class = (listing.free? ? 'btn btn-green btn-large' :  'btn btn-gray-light btn-large span6' )
            - rfq_label = (listing.free? ?  t('reservations.rfq') : t('reservations.offer'))

            - if listing.free?
              .rfq-explanation
                %span= t('reservations.rfq_explanation')
            .row-fluid
              = f.submit rfq_label, id:"rfq-#{listing.id}", class: rfq_class, :'data-behavior' => 'RFQ', :'data-modal-method' => 'GET', :'data-modal-url' => new_listing_ticket_path(listing), :'data-force-modal' => true, :'data-behavior' => 'RFQ'
              - if listing.free?
                .hidden
                  = f.submit t('reservations.book'), book_hash
              - else
                = f.submit t('reservations.book'), book_hash
          -else
            = f.submit t('reservations.book'), book_hash


    .clearfix

  - content_for :domready do
    $("##{listing.to_param} .quantity select").customSelect();
