.row-fluid
  - if f.object.billing_authorization.nil?
    .padding-bottom
      .row-fluid
        .span5.text
          .ico-lock= t 'payments.heading'
        .span7.credit-card-images
          = image_tag 'credit-cards.png', alt: "Visa, Mastercard, American Express, Discover"
          // TODO: move that to payment scope after merge with payment refactor
          = hidden_field_tag(:payment_method_nonce, nil, id: 'paypal-nonce')
        .clearfix

    = f.error :cc
    #paypal-button
  - else
    = t 'payments.already_authorized'

= render 'listings/reservations/confirm_reservations', f: f


- if payment_method.payment_gateway.client_token.present?
  = javascript_include_tag "https://js.braintreegateway.com/v2/braintree.js"
  - content_for :script do
    :javascript
      $(function() {
        if('braintree' in window) {
          braintree.setup("#{payment_method.payment_gateway.client_token}", 'paypal', {
            container: 'paypal-button',
            paymentMethodNonceInputField: $("#paypal-nonce"),
            onPaymentMethodReceived: function (payload) {
              $(".submit-payment").show()
            },
            onCancelled: function (payload) {
              $(".submit-payment").hide()
            },
          });
        }
      });
      $('.accordion').on('show.bs.collapse', function (e) {
        if ($(e.target).find(".accordion-inner #paypal-button").length) {
          if ($("#paypal-nonce").val().length == 0) {
            $(".submit-payment").hide()
          }
        } else {
          $(".submit-payment").show()
        }
      });
