.row-fluid
  - if f.object.billing_authorization.present?
    Payment has been already authorized. Please proceed.
  - else
    #credit-card
      = f.error :cc

      .padding-bottom
        .row-fluid
          .span5.text
            .ico-lock Submit a secure payment.
          .span7.credit-card-images
            = image_tag 'credit-cards.png', alt: "Visa, Mastercard, American Express, Discover"
          .clearfix


      .row-fluid
        .span3
          = f.label :card_holder_first_name do
            %abbr{ title: "required" } *
            First Name
        .span9
          = f.input_field :card_holder_first_name, class: 'sessioncamexclude', required: true, autocomplete: :off, value: (f.object.card_holder_first_name.presence || current_user.first_name)

      .row-fluid
        .span3
          = f.label :card_holder_last_name do
            %abbr{ title: "required" } *
            Last Name
        .span9
          = f.input_field :card_holder_last_name, class: 'sessioncamexclude', required: true, autocomplete: :off, value: (f.object.card_holder_last_name.presence || current_user.last_name)

      .row-fluid
        .span3.card-info{class: "#{"error" if f.object.errors.include?(:number).present?}"}
          = f.label :card_number, class: 'control-label' do
            %abbr{ title: "required" } *
            Card number
        .span9.input-icon-holder-right
          = f.input_field :card_number, required: true, placeholder: '●●●● ●●●● ●●●● ●●●●', class: 'sessioncamexclude', pattern: "[0-9]*", autocomplete: "off", 'data-card-number' => true
          %span.ico-credit-card
        - if f.object.errors[:number].present?
          %p.error-block
            = f.object.errors[:number].first

      .row-fluid
        .span3.card-info.expiry.column.left{class: "#{"error" if f.object.errors.include?(:card_exp_month).present? or f.object.errors.include?(:card_exp_year).present?}"}
          = f.label :card_exp_month, class: 'control-label' do
            %abbr{ title: "required" } *
            Expiration date
        .span2{class: "#{"error" if f.object.errors.include?(:card_exp_month).present?}"}
          .controls.card-expires
            = f.input_field :card_exp_month, collection: credit_card_date[:month], prompt: false, class: 'checkout-select sessioncamexclude'

          - if f.object.errors[:card_exp_month].present?
            %p.error-block
              = f.object.errors[:card_exp_month].first

        .span2{class: "#{"error" if f.object.errors.include?(:card_exp_year).present?}"}
          .controls.card-expires
            = f.input_field :card_exp_year, collection: credit_card_date[:year], prompt: false, class: 'checkout-select sessioncamexclude'

          - if f.object.errors[:card_exp_year].present?
            %p.error-block
              = f.object.errors[:card_exp_year].first

      .row-fluid
        .span3.card-info.security.column.right{class: "#{"error" if f.object.errors.include?(:cvc).present?}"}
          = f.label :card_code, class: 'control-label' do
            %abbr{ title: "required" } *
            Security code

        .span2
          .controls.card-code
            = f.input_field :card_code, input_html: {size: 3}, placeholder: 'CCV', required: true, class: 'sessioncamexclude', pattern: "[0-9]*", autocomplete: "off", 'data-card-code' => true
          - if f.object.errors[:cvc].present?
            %p.error-block
              = f.object.errors[:cvc].first

        .span2.whats-this
          %p.whats-this-link{"data-target" => "#whats-this-target", "data-toggle" => "collapse", :style => "cursor: pointer;"} (What's this?)

        .span5.whats-this.answer
          %p#whats-this-target.collapse The Card Security Code is usually a 3- or 4- digit number, typically printed on the back of a credit card (usually in the signature field)

= render 'listings/reservations/confirm_reservations', f: f


- content_for :script do
  = javascript_include_tag "https://js.stripe.com/v1/"
  :javascript
    $(function() {
      $('input[data-card-number]').eq(0).payment('formatCardNumber');
      $('input[data-card-code]').eq(0).payment('formatCardCVC');
    })
