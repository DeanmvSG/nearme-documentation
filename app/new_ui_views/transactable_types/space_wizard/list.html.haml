- render_without_left_menu!
- title "#{t('onboarding_wizard.list_your', name: @transactable_type.translated_bookable_noun)}"

- content_for :page_header do
  %h1= yield :title

#space-wizad
  = dashboard_simple_form_for @user, url: transactable_type_space_wizard_list_url(@transactable_type), html: { class: "new_company", multipart: true, id: 'list-space-flow-form', :"data-includes-address-field" => true }, method: :post do |f|

    = render "errors", f: f

    .row
      .col-md-4.col-md-offset-8.hidden-sm
        %p.listing-draft-cta
          %i<
            = t('onboarding_wizard.finish_later')

            = f.submit t('onboarding_wizard.save_draft.label'), :name => "save_as_draft", data: { disable_with: t('onboarding_wizard.save_draft.disable_with') }, :class => "saveasdraft btn-link"


    = f.simple_fields_for :seller_profile, @user.seller_profile || @user.build_seller_profile(instance_profile_type: current_instance.seller_profile_type) do |seller_profile_form|
      = seller_profile_form.simple_fields_for :properties, @user.seller_profile.properties do |seller_properties_form|
        = f.simple_fields_for :companies, @user.companies.first do |companies_form|
          = companies_form.simple_fields_for :locations, @user.companies.first.locations.first do |locations_form|
            = locations_form.simple_fields_for :listings, @user.companies.first.locations.first.listings.first do |listings_form|
              = listings_form.simple_fields_for :properties, @user.companies.first.locations.first.listings.first.properties do |properties_form|

                - @form_components.each do |form_component|
                  .panel
                    .panel-body

                      %h2= form_component.name

                      - form_component.form_fields.each do |form_field|
                        - model = form_field.keys.first
                        - field = form_field[model]
                        - if model == 'user'
                          = render :partial => 'registrations/new_attributes', :locals => { f: f, only_inputs: [field.to_sym], country: @country }
                        - if model == 'seller'
                          = render 'sellers/seller_form', f: seller_profile_form, properties_form: seller_properties_form, only_inputs: [ field.to_sym ]
                        - elsif model == 'company'
                          = render :partial => 'companies/company_form', :locals => { :f => companies_form, :company => companies_form.object, :only_inputs => [ field.to_sym ] }
                        - elsif model == 'location'
                          = render :partial => 'locations/location_form', :locals => { :f => locations_form, :location => locations_form.object, :only_inputs => [ field.to_sym ] }
                        - elsif model == 'transactable'
                          = render 'listings/listing_form', f: listings_form, properties_form: properties_form, listing: listings_form.object, only_inputs: [ field.to_sym ], photos: @photos, form_fields: form_component.form_fields, model: model

                = render 'listings/listing_form', f: listings_form, properties_form: properties_form, listing: listings_form.object, only_inputs: [ :transactable_type_id, :booking_type, :id ]

                .hidden
                  - Money::Currency.table.values.each do |c|
                    %span{:id => "currency_#{c[:iso_code]}"}
                      = c[:symbol]
                  %span{:id => "default_currency"}= @transactable_type.default_currency

    .panel.form-actions
      .panel-body
        = f.submit t('general.submit'), :name => "commit", data: { disable_with: 'Creating...' }, :class => "listmydesk"
